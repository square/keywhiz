language: java
sudo: required
dist: trusty

jdk:
  - oraclejdk8

env:
  - UI_DIR=ui

cache:
  directories:
    - $HOME/.m2

before_install:
  - sudo apt-get update
  - sudo apt-get install mysql-server-5.6 mysql-client-5.6
  # Extra Chrome setup from: http://stackoverflow.com/questions/19255976
  - export CHROME_BIN=chromium-browser
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - npm install karma && npm install karma-jasmine karma-chrome-launcher
  - cd $UI_DIR && npm install -g grunt-cli bower
  - npm install
  - bower install
  - grunt build && cd ..

script:
  - mvn test findbugs:check jacoco:report coveralls:report -P h2
  - cd $UI_DIR && grunt test
